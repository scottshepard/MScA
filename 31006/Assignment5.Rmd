---
title: "Assignment 5 - Multi Step Forecasts"
author: "Scott Shepard"
date: "5/2/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Prompt

Load data from TSA package (the package is written by authors Jonathan Cryer and Kung-Sik Chan).
```
> library("TSA")
> data(beersales)
```
The data is the monthly beer sales in millions of barrels, 01/1975 - 12/1990.

Train: 01/1975 - 12/1989.

Test: 1990

**Part 1**

Use ARIMA(p,d,q) model to forecast beer sales for all months of 1990 using the following two multi-step forecasting approaches. For each model, check mean, autocorrelation and normality of the residuals. Confirm if the residuals are white noise.

*1A* - Use the h-period in forecast() to forecast each month of 1990. This is also known as recursive forecasting where you fit a model only once and use it recursively for h-periods.

*1B* - Use the monthly data as a continuous time series. Forecast for 1990 Jan, Plug forecast into the time series, build a new model to forecast for 1990 Feb. And so on and so forth. In other words, h=1 in all the forecasts. This is known as direct recursive (DirRec) forecasting where you fit a new model for each time step.

*1C* - Plot the mean, the p-value of the autocorrelation test and the p-value of the normality test of the residuals of the 12 models.

**Part 2**

Plot the Recursive and DirRec along with the actuals. Use ylim=c(12.5, 17) to get a good visual of the plot differences.

**Part 3**

Calculate the MSE for 1990 - which of the two approaches give better result and why?

# Part 1

Plot beersales data, split into training and test.

```{r, message=FALSE, warning=FALSE}
library(TSA)
library(xts)
library(forecast)

data(beersales)

plot(as.xts(beersales))
```


```{r}
bs <- as.xts(beersales)

train <- window(beersales, end=c(1989,12))
test <- window(beersales, start=1990)
```


## 1A - Recursive

Use default options to resurvively forecast for 1990

```{r}
m1a <- auto.arima(train)
Rec = forecast(m1a, h=12)
plot(forecast(m1a, h=12))
```

## 1B

```{r}
train_adj <- train
f_1990 <- c()

for(i in 1:12) {
  print(i)
  m1b <- auto.arima(train_adj)
  pf <- forecast(m1b, h=1)$mean
  f_1990  <- c(f_1990,  pf)
  train_adj   <- ts(c(train_adj, pf), start=1975, frequency=12)
}
```

```{r, warning=FALSE, message=FALSE}
library(dplyr)

df <- data.frame(
  month = c(1:12), 
  obs=test, 
  DirRec=f_1990, 
  Rec = Rec$mean
  )
df
```


```{r, warning=FALSE, message=FALSE}
library(reshape2)
library(ggplot2)

melt(df, id.vars='month') %>% 
  ggplot(aes(x=month, y=value, color=variable, group=variable)) + 
  geom_line() + geom_point()
```


```{r}
df <- df %>% mutate(
    DirRecResid = DirRec - obs,
    RecResid = Rec - obs
  )

df %>% 
  select(month, DirRecResid, RecResid) %>%
  melt(id.vars='month') %>%
  ggplot(aes(x=month, y=value, fill=variable)) +
  geom_bar(stat="identity", position="dodge")
```


```{r}

```


```{r}

```


```{r}

```


```{r}

```


```{r}

```


```{r}

```


```{r}

```


```{r}

```


```{r}

```


```{r}

```


```{r}

```


```{r}

```


```{r}

```


