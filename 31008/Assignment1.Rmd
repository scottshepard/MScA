---
title: "31008: Assignment 1"
author: "Scott Shepard"
date: "7/7/2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r data}
library(caret)
data("GermanCredit")
GC <- GermanCredit
GC$Amount <- log(GC$Amount)
```

I chose to use only the installment rate
percentage and duration as variables for predicting amount. I tried various 
combinations of other variables but none of them led to higher R^2 values than
these two variables along. This makes sense as interest rate and amount of the
loan roughly determine the duration of the loan so the amount can be predicted
in reverse using these two variables.

Split the data and train the model.

```{r functions}
splitData <- function(data, smp_size) {
  # Take a dataset and split it randomly into train and test sets
  # The size of the training set is the smp_size argument
  train_ind <- sample(seq_len(nrow(data)), size = smp_size)
  train <- GC[ train_ind, ]
  test  <- GC[-train_ind, ]
  
  list("train"=train, "test"=test)
}

buildModel <- function(train, test) {
  # Wrapper function to build a model prediction Amount from a given training set
  # The model is fixed. This function is meant to operate inside a loop to build
  # the same model over and over again. 
  # It outputs the coefficients, train and test R^2 in a data frame
  fit <- lm(Amount ~ Duration + InstallmentRatePercentage, data=train)
  test$predictions <- predict(fit, test)
  list("model" = fit, 
       "coef" = fit$coefficients,
       "test_r2" = cor(test$predictions, test$Amount)^2,
       "train_r2" = summary(fit)$r.squared)
}
```

Split the data into train and test sets and then build the model, save the 

```{r split}
# Set the seed so the results are repeatable
set.seed(123)

# Build the same model 1000 times and save the output
models <- lapply(1:100, function(i) {
  data_list = splitData(GC, 632)
  buildModel(data_list$train, data_list$test)
})

df <- plyr::ldply(models, function(m) {
  df <- data.frame(t(m$coef))
  names(df)[1] <- "Intercept"
  df$test_r2 <- m$test_r2
  df$train_r2 <- m$train_r2
  df
})
```

```{r}
hist(df$Intercept)
hist(df$Duration)
hist(df$InstallmentRatePercentage)
hist(df$test_r2)
```
